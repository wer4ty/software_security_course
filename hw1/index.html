<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<!--<meta http-equiv="refresh" content="1">-->
	<title>Enigma</title>
	    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui.js" type="text/javascript"></script>
</head>
<body>



<div class="container">
	<div class="row">
		<div class="col-lg-3">

		<h3>Input letter</h3>
		 <input class="form-control" id="plainttext">

		 <h3>Cifer letter</h3>
		 <input disabled="" class="form-control" id="cifertext">

		 <h3>Message</h3>
		 <textarea readonly="true" class="form-control" id="message" rows="3"></textarea>
		 <button class="clear_btn btn btn-primary">Clear</button>

		 </div>

	<!--	 <div class="col-lg-9">

			<table id="table_dynamic" class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Use</th>
      <th scope="col">Ring Setting</th>
      <th scope="col">ABCDEFGHIJKLMNOPQRSTUVWXYZ</th>
      <th scope="col">Turnover notch</th>
      
    </tr>
  </thead>
  <tbody>
    <tr id="r1" class="highlight">
      <th scope="row">I</th>
      <td><input type="checkbox" class="ch_box" checked="true"></td>
      <td><span class="offset_enigma">1</span>
      <button class="left_off btn btn-primary"><</button> <button class="right_off btn btn-primary">></button></td>
      <td><b>E</b>KMFLGDQVZNTOWYHXUSPAIBRCJ</td>
      <td>Q -> R</td>
    </tr>
    <tr id="r2" class="highlight">
      <th scope="row">II</th>
      <td><input type="checkbox" class="ch_box" checked="true"></td>
      <td><span class="offset_enigma">1</span>
      <button class="left_off btn btn-primary"><</button> <button class="right_off btn btn-primary">></button></td>
      <td><b>A</b>JDKSIRUXBLHWTMCQGZNPYFVOE</td>
      <td>E -> F</td>
    </tr>
    <tr id="r3" class="highlight">
      <th scope="row">III</th>
      <td><input type="checkbox" class="ch_box" checked="true"></td>
      <td><span class="offset_enigma">1</span>
      <button class="left_off btn btn-primary"><</button> <button class="right_off btn btn-primary">></button></td>
      <td><b>B</b>DFHJLCPRTXVZNYEIWGAKMUSQO</td>
      <td>V -> W</td>
    </tr>
    <tr id="r4">
      <th scope="row">IV</th>
      <td><input type="checkbox" class="ch_box"></td>
      <td><span class="offset_enigma">1</span>
      <button class="left_off btn btn-primary"><</button> <button class="right_off btn btn-primary">></button></td>
      <td><b>E</b>SOVPZJAYQUIRHXLNFTGKDCMWB</td>
      <td>J -> K</td>
    </tr>
    <tr id="r5">
      <th scope="row">V</th>
      <td><input type="checkbox" class="ch_box"></td>
      <td><span class="offset_enigma">1</span>
      <button class="left_off btn btn-primary"><</button> <button class="right_off btn btn-primary">></button></td>
      <td><b>V</b>ZBRGITYUPSDNHLXAWMJQOFECK</td>
      <td>Z -> A</td>
    </tr>

      
  </tbody>
</table> 

		</div> -->
	</div>
</div>

<script type="text/javascript">

class Substitutor {
	constructor() {
		this.baseAZ = " ABCDEFGHIGKLMNOPQRSTUVWXYZ";
	}

	isLetter(c) {
		// return whitespace
		if ((c == ' ') || (c == '\t') || (c == '\n')) return c; 
		// check if letter: true => return upper case letter
		let x = c.match(/[a-z]/i);
		if ( x !== null) {
			return x[0].toUpperCase();
		}
		// false return undefined
	  return x;
	}

	indexViaAZ(c) {
		if (c !== undefined) 
	 	return this.baseAZ.indexOf(c.toUpperCase()); 
	}

	circular_shift(ind) {
		if (ind > 26) { ind = ind - 26;}
		if(ind < 1) { ind = 26 -  Math.abs(ind); }
		return ind;
	}
}	

class Translator extends Substitutor {
	constructor(az){
		super();
		this.az = az;
	}

	getAZ() { return this.az; }
	setAz(az) { this.az = az; }

	simple_translate(c) {
		let ind = this.indexViaAZ(c);
		if (this.isLetter(c) === undefined) return;
		else if(ind !== -1 ) return this.az[ind];
		return c;
	}
}

class Plugboard extends Translator {
	constructor(az){
		super(az);
	}
}

class Reflector extends Translator {
	constructor(az){
		super(az);
	}
}

class Rotor extends Translator {
	constructor(az, offset, setting, notch){
		super(az);
		this.offset = offset;
		this.setting = setting;
		this.notchLetter = notch;
	}

	getOffset() { return this.offset; }
	getSetting() { return this.setting; }
	getNotchLetter() { return this.notchLetter; }

	setSetting(s) {this.setting = s; }
	setOffset(off) { this.offset = off; }

	incrementOffset() {
		this.offset++;
		if(this.offset > 26 || this.offset <= 0) { this.offset = 1; }
	}

	forward_translate(c) {
		this.incrementOffset();
		let a_index = this.indexViaAZ(c);
		let P = a_index + this.offset;
		P = this.circular_shift(P);
		P = P - this.setting;
		P = this.circular_shift(P);

		let tmp_c = this.az.charAt(P);
		let b_index = this.indexViaAZ(tmp_c);



		P = b_index - this.offset;

		P = this.circular_shift(P);

		P = P + this.setting;
		P = this.circular_shift(P);

		return this.baseAZ.charAt(P);
	}

	notch() {
		if (this.indexViaAZ(this.notchLetter) === this.offset) {
			return true;
		}
		return false;
	}
}


// 	reflector(
// 		rotor(
// 			rotor( 
// 				rotor(
// 					{c : plugboard(isLetter('a')),  notch_action: true}, 1, "EKMFLGDQVZNTOWYHXUSPAIBRCJ", 'R',1
// 					),
// 				1, "AJDKSIRUXBLHWTMCQGZNPYFVOE", 'F',1),
// 			1, "BDFHJLCPRTXVZNYEIWGAKMUSQO", 'W',1),
// 		"YRUHQSLDPXNGOKMIEBFZCWVJAT"
// 		)


let ref = new Reflector(" YRUHQSLDPXNGOKMIEBFZCWVJAT");
let plu = new Plugboard(" SUCDEZGHIJKLMNCPQYATBVWXRF");
let rotor1 = new Rotor(" EKMFLGDQVZNTOWYHXUSPAIBRCJ", 1, 1, "R");
let rotor2 = new Rotor(" AJDKSIRUXBLHWTMCQGZNPYFVOE", 1, 1, "F");
let rotor3 = new Rotor(" BDFHJLCPRTXVZNYEIWGAKMUSQO", 1, 1, "W");
let rotor4 = new Rotor(" ESOVPZJAYQUIRHXLNFTGKDCMWB", 1, 1, "K");
let rotor5 = new Rotor(" VZBRGITYUPSDNHLXAWMJQOFECK", 25, 5, "A");

function encrypt(c) {
	

	//let step1 = plu.simple_translate(c);
	//let step2 = ref.simple_translate(step1);
	let step3 = rotor5.forward_translate(c);
	return step3;
}

// Vizualization
$(function(){

	$( "#plainttext" ).focus();

	$("#plainttext").keyup(function(){

		let x = $(this).val();
		$("#cifertext").val(encrypt(x[x.length-1]));
		$("#plainttext").val(x[x.length-1]);
		$("#message").val($("#message").val().concat($("#cifertext").val()));
		
	});

	$(".clear_btn").click(function(){
		$("#cifertext, #plainttext, #message").val("");
	});
})

</script>

</body>
</html>